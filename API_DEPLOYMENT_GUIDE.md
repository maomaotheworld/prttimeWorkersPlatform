# å·¥è®€ç”Ÿç®¡ç†å¹³å° - API èˆ‡éƒ¨ç½²èªªæ˜

## âœ… å·²å®Œæˆçš„é‡è¦ä¿®æ”¹

### 1. **æ™‚æ•¸èª¿æ•´åŠŸèƒ½æ”¹é€²** (æœ€æ–°)
- âœ… æ”¯æŒ**ç´¯åŠ æ¨¡å¼**:æ¯æ¬¡æ–°å¢æˆ–æ‰£é™¤å·¥æ™‚éƒ½æœƒç–ŠåŠ è¨˜éŒ„
- âœ… æ–°å¢**èª¿æ•´é¡å‹é¸æ“‡**:å¯é¸æ“‡ã€Œæ–°å¢å·¥æ™‚ã€æˆ–ã€Œæ‰£é™¤å·¥æ™‚ã€
- âœ… **è©³ç´°è¨˜éŒ„è¿½è¹¤**:æ¯æ¬¡èª¿æ•´éƒ½æœƒè¨˜éŒ„æ“ä½œè€…ã€æ™‚é–“å’ŒåŸå› 
- âœ… **è¦–è¦ºåŒ–é¡¯ç¤º**:å·¥æ™‚è¨˜éŒ„é é¢æœƒé¡¯ç¤ºæ‰€æœ‰èª¿æ•´è¨˜éŒ„çš„æ¨™ç±¤

### 2. **å¾Œç«¯ API å®Œæ•´ä¿®å¾©**
- âœ… æ·»åŠ æ‰€æœ‰æ•¸æ“šçš„**æŒä¹…åŒ–åŠŸèƒ½**:
  - `saveGroups()` - çµ„åˆ¥æ•¸æ“šæŒä¹…åŒ–
  - `saveTimeRecords()` - å·¥æ™‚è¨˜éŒ„æŒä¹…åŒ–
  - `saveSalaryAdjustments()` - è–ªè³‡èª¿æ•´æŒä¹…åŒ–
- âœ… ä¿®æ”¹**èªè­‰ä¸­é–“ä»¶**:é–‹ç™¼ç’°å¢ƒå…è¨±ç„¡ token è¨ªå•,ç”Ÿç”¢ç’°å¢ƒå¼·åˆ¶èªè­‰
- âœ… æ‰€æœ‰ API ç«¯é»åœ¨æ•¸æ“šè®Šæ›´å¾Œéƒ½æœƒè‡ªå‹•ä¿å­˜

### 3. **å‰ç«¯ API è½‰æ›**
- âœ… å®Œå…¨ç§»é™¤ axios ä¾è³´
- âœ… æ‰€æœ‰é é¢æ”¹ç”¨ `fetch` API ç›´æ¥èª¿ç”¨å¾Œç«¯
- âœ… çµ±ä¸€éŒ¯èª¤è™•ç†å’Œè¨Šæ¯æç¤º

## ğŸ“‹ API ç«¯é»èªªæ˜

### æ™‚æ•¸èª¿æ•´ API (é‡é»)
```
POST /api/time-records/additional-hours
```

**è«‹æ±‚åƒæ•¸:**
```json
{
  "workerId": "worker-id",
  "date": "2026-01-21",
  "hours": 2.5,  // å¯¦éš›æ™‚æ•¸å€¼(æ­£æ•¸)
  "reason": "åŠ ç­åŸå› ",
  "adjustmentType": "add"  // "add" æ–°å¢ æˆ– "subtract" æ‰£é™¤
}
```

**å¾Œç«¯è™•ç†é‚è¼¯:**
1. æ ¹æ“š `adjustmentType` æ±ºå®šå¯¦éš›æ™‚æ•¸:
   - `add`: æ­£æ•¸ (ä¾‹å¦‚: +2.5 å°æ™‚)
   - `subtract`: è² æ•¸ (ä¾‹å¦‚: -2.5 å°æ™‚)
2. å°‡èª¿æ•´è¨˜éŒ„æ·»åŠ åˆ° `adjustments` é™£åˆ—
3. ç´¯åŠ åˆ° `additionalHours` æ¬„ä½
4. è¨˜éŒ„æ“ä½œè€…è³‡è¨Šå’Œæ™‚é–“

**å›æ‡‰æ ¼å¼:**
```json
{
  "success": true,
  "data": {
    "id": "record-id",
    "workerId": "worker-id",
    "date": "2026-01-21",
    "clockIn": null,
    "clockOut": null,
    "totalHours": 0,
    "additionalHours": 2.5,  // ç´¯åŠ å¾Œçš„ç¸½é¡å¤–å·¥æ™‚
    "adjustments": [  // æ‰€æœ‰èª¿æ•´è¨˜éŒ„
      {
        "id": "adj-id-1",
        "hours": 2,
        "reason": "ç¬¬ä¸€æ¬¡åŠ ç­",
        "operatorId": "user-id",
        "operatorName": "æ“ä½œè€…åç¨±",
        "createdAt": "2026-01-21T10:00:00.000Z"
      },
      {
        "id": "adj-id-2",
        "hours": 0.5,
        "reason": "ç¬¬äºŒæ¬¡åŠ ç­",
        "operatorId": "user-id",
        "operatorName": "æ“ä½œè€…åç¨±",
        "createdAt": "2026-01-21T14:00:00.000Z"
      }
    ]
  },
  "message": "æ™‚æ•¸æ–°å¢æˆåŠŸ"
}
```

## ğŸš€ æœ¬åœ°é–‹ç™¼ç’°å¢ƒ

### 1. å¾Œç«¯å•Ÿå‹•
```powershell
cd backend
node index.js
```
- é»˜èªç«¯å£: `3005`
- é–‹ç™¼æ¨¡å¼: å…è¨±ç„¡ token è¨ªå•
- æ•¸æ“šæ–‡ä»¶æœƒè‡ªå‹•åœ¨ `backend/data/` ç›®éŒ„å‰µå»º

### 2. å‰ç«¯å•Ÿå‹•
```powershell
cd frontend
npm run dev
```
- é»˜èªç«¯å£: `5175`
- API URL: `http://localhost:3005`

### 3. æ¸¬è©¦æ™‚æ•¸èª¿æ•´åŠŸèƒ½

**å ´æ™¯ 1: å·¥è®€ç”ŸåŠ ç­ 2 å°æ™‚**
```javascript
fetch('http://localhost:3005/api/time-records/additional-hours', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer YOUR_TOKEN'
  },
  body: JSON.stringify({
    workerId: 'worker-1',
    date: '2026-01-21',
    hours: 2,
    reason: 'æ™šç­åŠ ç­',
    adjustmentType: 'add'
  })
})
```

**å ´æ™¯ 2: æ‰£é™¤é²åˆ° 0.5 å°æ™‚**
```javascript
fetch('http://localhost:3005/api/time-records/additional-hours', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer YOUR_TOKEN'
  },
  body: JSON.stringify({
    workerId: 'worker-1',
    date: '2026-01-21',
    hours: 0.5,
    reason: 'é²åˆ°æ‰£æ™‚',
    adjustmentType: 'subtract'
  })
})
```

**çµæœ:**
- ç¬¬ä¸€æ¬¡èª¿æ•´å¾Œ: `additionalHours = 2`
- ç¬¬äºŒæ¬¡èª¿æ•´å¾Œ: `additionalHours = 1.5` (2 - 0.5)
- `adjustments` é™£åˆ—åŒ…å«å…©ç­†è¨˜éŒ„

## â˜ï¸ Vercel éƒ¨ç½²

### 1. å¾Œç«¯éƒ¨ç½²

**é…ç½®æ–‡ä»¶:** `backend/vercel.json`
```json
{
  "version": 2,
  "builds": [
    {
      "src": "index.js",
      "use": "@vercel/node"
    }
  ],
  "routes": [
    {
      "src": "/(.*)",
      "dest": "index.js"
    }
  ],
  "env": {
    "NODE_ENV": "production"
  }
}
```

**éƒ¨ç½²æ­¥é©Ÿ:**
```bash
cd backend
vercel --prod
```

**ç’°å¢ƒè®Šæ•¸è¨­ç½®:**
- `NODE_ENV=production` (åœ¨ Vercel å¾Œå°è¨­ç½®)
- `JWT_SECRET=your-strong-secret-key` (åœ¨ Vercel å¾Œå°è¨­ç½®)

### 2. å‰ç«¯éƒ¨ç½²

**é…ç½®æ–‡ä»¶:** `frontend/vercel.json`
```json
{
  "name": "parttime-workers-frontend",
  "version": "2",
  "builds": [
    {
      "src": "package.json",
      "use": "@vercel/static-build",
      "config": {
        "distDir": "dist"
      }
    }
  ],
  "routes": [
    {
      "src": "/api/(.*)",
      "dest": "/api/$1"
    },
    {
      "src": "/(.*)",
      "dest": "/index.html"
    }
  ]
}
```

**ç’°å¢ƒè®Šæ•¸è¨­ç½®:**
```bash
# åœ¨ Vercel å¾Œå°è¨­ç½®
VITE_API_URL=https://your-backend-api.vercel.app
```

**éƒ¨ç½²æ­¥é©Ÿ:**
```bash
cd frontend
npm run build
vercel --prod
```

## ğŸ”§ ç’°å¢ƒè®Šæ•¸é…ç½®

### å¾Œç«¯ `.env`
```bash
PORT=3005
JWT_SECRET=your-secret-key-here-please-change-in-production
NODE_ENV=development
```

### å‰ç«¯ `.env`
```bash
# æœ¬åœ°é–‹ç™¼
VITE_API_URL=http://localhost:3005

# ç”Ÿç”¢ç’°å¢ƒ
# VITE_API_URL=https://your-backend-api.vercel.app
```

## ğŸ“Š æ•¸æ“šæŒä¹…åŒ–

æ‰€æœ‰æ•¸æ“šéƒ½æœƒè‡ªå‹•ä¿å­˜åˆ° `backend/data/` ç›®éŒ„:
- `workers.json` - å·¥è®€ç”Ÿè³‡æ–™
- `groups.json` - çµ„åˆ¥è³‡æ–™
- `timeRecords.json` - å·¥æ™‚è¨˜éŒ„ (åŒ…å«ç´¯åŠ çš„èª¿æ•´è¨˜éŒ„)
- `salaryAdjustments.json` - è–ªè³‡èª¿æ•´è¨˜éŒ„
- `users.json` - ç”¨æˆ¶å¸³è™Ÿè³‡æ–™

## ğŸ›¡ï¸ èªè­‰æ©Ÿåˆ¶

### é–‹ç™¼ç’°å¢ƒ (NODE_ENV !== 'production')
- å…è¨±ç„¡ token è¨ªå•æ‰€æœ‰ API
- è‡ªå‹•ä½¿ç”¨ `{ id: 'dev-user', role: 'admin' }` èº«ä»½

### ç”Ÿç”¢ç’°å¢ƒ (NODE_ENV === 'production')
- å¼·åˆ¶è¦æ±‚ JWT token
- å¿…é ˆåœ¨ Header ä¸­æä¾›: `Authorization: Bearer <token>`

## ğŸ¯ æ¸¬è©¦æª¢æŸ¥æ¸…å–®

### æ™‚æ•¸èª¿æ•´åŠŸèƒ½æ¸¬è©¦
- [ ] æ–°å¢å·¥æ™‚:é¸æ“‡å·¥è®€ç”Ÿã€æ—¥æœŸã€è¼¸å…¥ 2 å°æ™‚ã€é¸æ“‡ã€Œæ–°å¢å·¥æ™‚ã€ã€å¡«å¯«ç†ç”±
- [ ] æ‰£é™¤å·¥æ™‚:é¸æ“‡åŒä¸€å·¥è®€ç”Ÿã€åŒä¸€æ—¥æœŸã€è¼¸å…¥ 0.5 å°æ™‚ã€é¸æ“‡ã€Œæ‰£é™¤å·¥æ™‚ã€ã€å¡«å¯«ç†ç”±
- [ ] æª¢æŸ¥å·¥æ™‚è¨˜éŒ„é é¢:æ‡‰é¡¯ç¤ºé¡å¤–å·¥æ™‚ = 1.5 å°æ™‚
- [ ] æª¢æŸ¥èª¿æ•´è¨˜éŒ„:æ‡‰é¡¯ç¤ºå…©å€‹æ¨™ç±¤ (+2h å’Œ -0.5h)
- [ ] é‡è¤‡æ“ä½œ:å¤šæ¬¡æ–°å¢æ‰£é™¤,ç¢ºèªç´¯åŠ æ­£ç¢º

### API åŠŸèƒ½æ¸¬è©¦
- [ ] å·¥è®€ç”Ÿç®¡ç†:æ–°å¢ã€ç·¨è¼¯ã€åˆªé™¤
- [ ] çµ„åˆ¥ç®¡ç†:æ–°å¢ã€ç·¨è¼¯ã€åˆªé™¤
- [ ] æ‰“å¡ç³»çµ±:ä¸Šç­æ‰“å¡ã€ä¸‹ç­æ‰“å¡
- [ ] ç·¨è¼¯æ‰“å¡æ™‚é–“:ä¿®æ”¹ä¸Šä¸‹ç­æ™‚é–“
- [ ] Excel åŒ¯å…¥:ä¸Šå‚³ Excel æ–‡ä»¶
- [ ] è–ªè³‡è¨ˆç®—:æŸ¥çœ‹å·¥è®€ç”Ÿè–ªè³‡

## ğŸ“ å¸¸è¦‹å•é¡Œ

### Q: æ™‚æ•¸èª¿æ•´å¾Œè–ªè³‡å¦‚ä½•è¨ˆç®—?
A: ç¸½å·¥æ™‚ = æ­£å¸¸å·¥æ™‚ (`totalHours`) + é¡å¤–å·¥æ™‚ (`additionalHours`)
   è–ªè³‡ = ç¸½å·¥æ™‚ Ã— æ™‚è–ª

### Q: å¯ä»¥ä¿®æ”¹æˆ–åˆªé™¤å·²æäº¤çš„æ™‚æ•¸èª¿æ•´å—?
A: ç›®å‰ä¸æ”¯æŒä¿®æ”¹æˆ–åˆªé™¤,å»ºè­°ä½¿ç”¨åå‘èª¿æ•´(ä¾‹å¦‚:èª¤æ‰£ 0.5 å°æ™‚,å¯ä»¥æ–°å¢ 0.5 å°æ™‚ä¾†ä¿®æ­£)

### Q: Vercel éƒ¨ç½²å¾Œæ•¸æ“šæœƒä¿ç•™å—?
A: Vercel çš„ Serverless ç’°å¢ƒä¸æ”¯æŒæ–‡ä»¶ç³»çµ±æŒä¹…åŒ–,å»ºè­°:
   1. ä½¿ç”¨ Vercel KV æˆ– Postgres æ•¸æ“šåº«
   2. æˆ–ä½¿ç”¨ç¬¬ä¸‰æ–¹æ•¸æ“šåº«æœå‹™ (MongoDB, Supabase ç­‰)

### Q: é–‹ç™¼ç’°å¢ƒä¸‹ç„¡æ³•é€£æ¥å¾Œç«¯?
A: æª¢æŸ¥:
   1. å¾Œç«¯æ˜¯å¦æ­£å¸¸é‹è¡Œåœ¨ port 3005
   2. å‰ç«¯ `.env` æ–‡ä»¶ä¸­ `VITE_API_URL` æ˜¯å¦æ­£ç¢º
   3. ç€è¦½å™¨æ§åˆ¶å°æ˜¯å¦æœ‰ CORS éŒ¯èª¤

## ğŸ”„ ç‰ˆæœ¬è¨˜éŒ„

### v1.3.0 (2026-01-21)
- âœ… é‡æ§‹æ™‚æ•¸èª¿æ•´åŠŸèƒ½ç‚ºç´¯åŠ æ¨¡å¼
- âœ… æ·»åŠ èª¿æ•´é¡å‹é¸æ“‡ (æ–°å¢/æ‰£é™¤)
- âœ… æ·»åŠ è©³ç´°èª¿æ•´è¨˜éŒ„è¿½è¹¤
- âœ… å®Œå–„æ‰€æœ‰ API çš„æ•¸æ“šæŒä¹…åŒ–
- âœ… å„ªåŒ–èªè­‰ä¸­é–“ä»¶é©é…é–‹ç™¼/ç”Ÿç”¢ç’°å¢ƒ

### v1.2.0
- å®Œæˆä¸‰ç´šæ¬Šé™ç³»çµ±
- Excel åŒ¯å…¥åŠŸèƒ½
- æ‰“å¡ç³»çµ±å’Œå·¥æ™‚è¨˜éŒ„

### v1.1.0
- åŸºç¤å·¥è®€ç”Ÿç®¡ç†
- çµ„åˆ¥ç®¡ç†
- è–ªè³‡è¨ˆç®—

## ğŸ“ æŠ€è¡“æ”¯æŒ

å¦‚é‡åˆ°å•é¡Œ,è«‹æª¢æŸ¥:
1. å¾Œç«¯æ§åˆ¶å°è¼¸å‡º
2. ç€è¦½å™¨é–‹ç™¼è€…å·¥å…· Network æ¨™ç±¤
3. `backend/data/` ç›®éŒ„ä¸‹çš„ JSON æ–‡ä»¶å…§å®¹
